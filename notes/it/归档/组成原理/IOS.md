# IO系统

负责管理与实现主机与外部设备通信的部分

***

## 概述

* 发展概况
  * 分散连接阶段
    > CPU与IO串行工作，程序查询方式。
  * 接口模块和DMA阶段
    > CPU与IO并行工作，中断方式、DMA方式。
  * 通道结构阶段
  * 具有**IO处理机**阶段

* 组成
  * IO软件
    * IO指令
      > CPU指令一部分<br>操作码 命令码 设备码
    * 通道指令
      > 通道自己的指令<br>指出数组首地址、字数、操作命令
  * IO硬件
    * 带接口
    * 带通道

## IO接口

* 与主机的联系方式
  * 编址方式
    * 统一编址
      > 不需要专门的IO指令，存取灵活<br>占去主存空间，程序不易阅读
    * 单独编址
      > IO地址空间独立，控制及译码电路相对简单，专用IO指令使程序易于阅读<br>IO指令没有存储器指令丰富
  * 设备寻址
    > 由IO指令的设备码字段指出设备号，通过选择电路，选择设备号对应设备。
  * 传送方式
    * 串行
    * 并行
  * 联络方式
    * 立即响应
    * 异步工作采用应答信号
      > 应答信号指ready信号（接收就绪）与strobe信号（数据的有效边沿）
    * 同步工作采用同步时标（时钟信号）
  * 连接方式
    * 辐射式连接
    * 总线连接

## IO与主机传送的控制方式

* 程序查询方式
  > CPU通过程序不断向IO设备查询，直到IO设备准备好数据，才进行数据传送。
  >
  > 设置计数器->设置主存缓冲区首址->启动外设->检查是否就绪->传送一个数据->修改主存地址->修改计数值->检查是否传完->重复。

* 程序中断方式
  > CPU在执行程序时，当IO设备准备好数据时，向CPU发出中断请求，CPU停止当前程序，执行中断程序，完成数据传送后，再返回原程序继续执行。
  * 目的
    * 提高整机效率
    * 应付突发事件
    * 实现实时控制
  * CPU响应中断的条件
    > CPU将允许中断触发器置1
  * 流程
    * 中断请求
    * 中断判优
    * 中断响应
    * 中断服务
      1. 保护现场
         > 程序断点的保护由中断隐指令完成，寄存器内容的保护由进栈指令完成。 
      2.  服务
      3.  恢复现场
    * 中断返回
  * 多重中断

<br>

* DMA方式
  > 主存和IO之间有一条直接数据通道。当数据准备就绪之后，IO发出信号，周期挪用，传送中断程序之数据。
  * 特点
    * 不中断现行程序
    * 周期挪用
    * CPU和IO并行工作
  * DMA与主存交换数据的方式
    * 停止CPU访问主存
      > 不能充分利用CPU但控制简单。
    * 周期窃取
      > CPU不访存时，无冲突<br>CPU正在访存，存取周期结束后，CPU释放总线控制权<br>同时请求时，DMA优先
    * CPU与DMA交替访问主存
      > C<sub>1</sub>专供CPU访问，C<sub>2</sub>专供DMA访问<br>不需要像周期窃取一样建立和归还总线控制权但实现逻辑复杂。
  * 接口功能
    * 向CPU申请DMA传送
    * 处理总线控制权转移
    * 管理系统总线，控制数据传输
    * DMA传送结束后，发出完成信号
  * 测试过程
    * 预处理
    * 数据传输
    * 后处理

## IO接口

指主机与IO设备之间设置的硬件电路及相应的软件控制

* 目的
  * 实现设备的选择
  * 实现数据缓冲达到速度匹配
  * 实现数据串-并格式转换
  * 实现电平转换
  * 传送控制命令
  * 反应设备状态

* 组成
  * 设备选择电路
  * 命令寄存器、命令译码器
  * 数据缓冲寄存器
  * 设备状态标记

$\begin{cases}
    \text{完成触发器D} 
    \\\\
    \text{工作触发器B}
    \\\\
    \text{中断请求触发器INTR}
    \\\\
    \text{屏蔽触发器MASK}
    \end{cases}$

* 类型
  * 按传送方式分
    * 串行接口&emsp;8251
    * 并行接口&emsp;8255
  * 按选择的灵活性分
    * 可编程接口&emsp;8251
    * 不可编程接口&emsp;8212
  * 按通用性分
    * 通用接口&emsp;8255
    * 专用接口&emsp;8279
  * 按控制方式分
    * 程序中断接口&emsp;8259
    * DMA接口&emsp;8237